<html>
  <head>
    <style>
      * {
        margin: 0;
      }
      .pixel {
        width: 1.81%;
        height: 1.81%;
        float: left;
      }
    </style>
  </head>
  <body>
    <input
      id="colorPicker"
      style="position: absolute;"
      type="color"
      value="#7515c4"
      onchange="updateInput()"
    />
    <script>
      const url = "https://fathomless-plains-73871.herokuapp.com";
      let index;
      let color = "7515c4"; //"ffffff"
      const size = 3025;

      function updateInput() {
        color = document.getElementById("colorPicker").value.substring(1);
        console.log(color);
      }

      function change(index) {
        fetch(`${url}/db/add/${index}/${color}`);
      }

      function read() {
        fetch(`${url}/db`)
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            for (let i = 0; i < size; i++) {
              pixels[i].style.backgroundColor = "#" + data[i];
            }
          });
      }

      for (let i = 0; i < size; i++) {
        document.body.innerHTML += "<div class='pixel'></div>";
      }

      const pixels = document.getElementsByClassName("pixel");
      let mouseDown = 0;
      document.body.onmousedown = function () {
        mouseDown = 1;
      };
      document.body.onmouseup = function () {
        mouseDown = 0;
      };

      for (let i = 0; i < size; i++) {
        pixels[i].onmousedown = function () {
          pixels[i].style.backgroundColor = color;
          change(i);
        };
        pixels[i].onmouseover = function () {
          if (mouseDown == 1) {
            pixels[i].style.backgroundColor = color;
            change(i);
          }
        };
      }

      const events = new EventSource(url + "/db/test");
      events.onmessage = (event) => {
        const data = JSON.parse(event.data);
        pixels[data.index].style.backgroundColor = "#" + data.color;
      };

      read();
    </script>
  </body>
</html>
